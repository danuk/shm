#!/usr/bin/env perl

use v5.14;
use Test::More;

use Core::Utils qw(sum_period parse_period);

# Тестируем sum_period
subtest 'sum_period basic tests' => sub {
    # Базовые тесты
    is(sum_period("1.0515", "2.1020"), "3.1611", "Сложение двух периодов");
    is(sum_period("0.0015", "0.0010"), "0.0101", "Сложение с переносом часов в дни");
    is(sum_period("0.1500", "0.1800"), "1.0300", "Сложение с переносом дней в месяцы");
    is(sum_period("5.2418"), "5.2418", "Одно значение остается без изменений");
    is(sum_period("0.0000", "0.0000"), "0.0000", "Нулевые значения");
};

subtest 'sum_period edge cases' => sub {
    # Граничные случаи
    is(sum_period(), "0.0000", "Пустой список");
    is(sum_period("", undef, ""), "0.0000", "Только пустые значения");
    is(sum_period("1.0515", "", undef, "2.1020"), "3.1611", "Игнорирование пустых значений");
    is(sum_period("0.0059"), "0.0211", "59 часов = 2 дня 11 час");
    is(sum_period("0.5900"), "1.2900", "59 дней = 1 месяц 29 дней");
};

subtest 'sum_period normalization' => sub {
    # Тесты нормализации
    is(sum_period("0.2930", "0.0150"), "1.0308", "Сложная нормализация");
    is(sum_period("0.0101", "0.0101", "0.0101", "0.0101", "0.0101"), "0.0505", "Много маленьких значений");
    is(sum_period("12.2945", "8.1535", "3.0820"), "24.2604", "Большие значения");
};

subtest 'sum_period list context' => sub {
    # Тесты в list context
    my ($m, $d, $h) = sum_period("1.0515", "2.1020");
    is($m, 3, "Месяцы в list context");
    is($d, 16, "Дни в list context");
    is($h, 11, "Часы в list context");

    ($m, $d, $h) = sum_period();
    is($m, 0, "Пустой список - месяцы");
    is($d, 0, "Пустой список - дни");
    is($h, 0, "Пустой список - часы");

    ($m, $d, $h) = sum_period("0.5959");
    is($m, 2, "59 дней 59 час - месяцы");
    is($d, 1, "59 дней 59 час - дни");
    is($h, 11, "59 дней 59 час - часы");
};

done_testing();
