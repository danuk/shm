
do_sql( q(
    ALTER TABLE acts CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE acts_data CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE apps CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE discounts CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE dns_services CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE domains CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE domains_services CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE invoices CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE pays_history CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE servers CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE servers_groups CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE services CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE events CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE spool CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE spool_history CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE user_services CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE withdraw_history CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE zones CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE identities CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE templates CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE console CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE profiles CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE config CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE sessions CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE storage CONVERT TO CHARACTER SET utf8mb4;
    ALTER TABLE bonus_history CONVERT TO CHARACTER SET utf8mb4;

    INSERT INTO `templates` VALUES ('telegram_bot','<% SWITCH cmd %>\n<% CASE \'USER_NOT_FOUND\' %>\n{\n    \"sendMessage\": {\n        \"text\": \"–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –±–æ—Ç–æ–º —É–∫–∞–∂–∏—Ç–µ _Telegram –ª–æ–≥–∏–Ω_ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞.\\n\\n*Telegram –ª–æ–≥–∏–Ω*: {{ message.chat.username }}\\n\\n*–ö–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è*: {{ config.cli.url }}\"\n    }\n}\n<% CASE [\'/start\', \'/menu\'] %>\n{{ IF cmd == \'/menu\' }}\n{\n    \"deleteMessage\": { \"message_id\": {{ message.message_id }} }\n},\n{{ END }}\n{\n    \"sendMessage\": {\n        \"text\": \"–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ VPN –∫–ª—é—á–∞–º–∏\",\n        \"reply_markup\": {\n            \"inline_keyboard\": [\n                [\n                    {\n                        \"text\": \"üí∞ –ë–∞–ª–∞–Ω—Å\",\n                        \"callback_data\": \"/balance\"\n                    }\n                ],\n                [\n                    {\n                        \"text\": \"üóù  –ö–ª—é—á–∏\",\n                        \"callback_data\": \"/list\"\n                    }\n                ]\n            ]\n        }\n    }\n}\n<% CASE \'/balance\' %>\n{\n    \"deleteMessage\": { \"message_id\": {{ message.message_id }} }\n},\n{\n    \"sendMessage\": {\n        \"text\": \"üí∞ *–ë–∞–ª–∞–Ω—Å*: {{ user.balance }}\\n\\n–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–ª–∞—Ç–∏—Ç—å: * {{ user.pays.forecast.total }}*\",\n        \"reply_markup\" : {\n            \"inline_keyboard\": [\n                [\n                    {\n                        \"text\": \"‚á¶ –ù–∞–∑–∞–¥\",\n                        \"callback_data\": \"/menu\"\n                    }\n                ]\n            ]\n        }\n    }\n}\n<% CASE \'/list\' %>\n{\n    \"deleteMessage\": { \"message_id\": {{ message.message_id }} }\n},\n{\n    \"sendMessage\": {\n        \"text\": \"üóù  –ö–ª—é—á–∏\",\n        \"reply_markup\" : {\n            \"inline_keyboard\": [\n                {{ FOR item IN user.services.list_for_api( \'category\', \'%\' ) }}\n                {{ SWITCH item.status }}\n                  {{ CASE \'ACTIVE\' }}\n                  {{ status = \'‚úÖ\' }}\n                  {{ CASE \'BLOCK\' }}\n                  {{ status = \'‚ùå\' }}\n                  {{ CASE \'NOT PAID\' }}\n                  {{ status = \'üí∞\' }}\n                  {{ CASE }}\n                  {{ status = \'‚è≥\' }}\n                {{ END }}\n                [\n                    {\n                        \"text\": \"{{ status }} - {{ item.name }}\",\n                        \"callback_data\": \"/service {{ item.user_service_id }}\"\n                    }\n                ],\n                {{ END }}\n                [\n                    {\n                        \"text\": \"‚á¶ –ù–∞–∑–∞–¥\",\n                        \"callback_data\": \"/menu\"\n                    }\n                ]\n            ]\n        }\n    }\n}\n<% CASE \'/service\' %>\n{{ us = user.services.list_for_api( \'usi\', args.0 ) }}\n{\n    \"deleteMessage\": { \"message_id\": {{ message.message_id }} }\n},\n{\n    \"sendMessage\": {\n        \"text\": \"*–ö–ª—é—á*: {{ us.name }}\\n\\n*–û–ø–ª–∞—á–µ–Ω –¥–æ*: {{ us.expire }}\\n\\n*–°—Ç–∞—Ç—É—Å*: {{ us.status }}\",\n        \"reply_markup\" : {\n            \"inline_keyboard\": [\n                {{ IF us.status == \'ACTIVE\' }}\n                [\n                    {\n                        \"text\": \"üóù  –°–∫–∞—á–∞—Ç—å –∫–ª—é—á\",\n                        \"callback_data\": \"/download_qr {{ args.0 }}\"\n                    },\n                    {\n                        \"text\": \"üëÄ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥\",\n                        \"callback_data\": \"/show_qr {{ args.0 }}\"\n                    }\n                ],\n                {{ END }}\n                [\n                    {\n                        \"text\": \"‚á¶ –ù–∞–∑–∞–¥\",\n                        \"callback_data\": \"/list\"\n                    }\n                ]\n            ]\n        }\n    }\n}\n<% CASE \'/download_qr\' %>\n{\n    \"uploadDocumentFromStorage\": {\n        \"name\": \"vpn{{ args.0 }}\",\n        \"filename\": \"vpn{{ args.0 }}.txt\"\n    }\n}\n<% CASE \'/show_qr\' %>\n{\n    \"uploadPhotoFromStorage\": {\n        \"name\": \"vpn{{ args.0 }}\",\n        \"format\": \"qr_code_png\"\n    }\n}\n<% END %>\n\n',NULL);
));

1;
